{% extends 'base.html' %}
{% block content %}

<h2 class="mb-4">ðŸ“‹ Reports</h2>

<div class="card p-3 mb-4 shadow">
  <form method="get" class="row g-3">
    <div class="col-md-2">{{ form.start_date.label_tag }} {{ form.start_date }}</div>
    <div class="col-md-2">{{ form.end_date.label_tag }} {{ form.end_date }}</div>
    <div class="col-md-3">{{ form.referred_by.label_tag }} {{ form.referred_by }}</div>
    <div class="col-md-3">{{ form.sonologist.label_tag }} {{ form.sonologist }}</div>
    <div class="col-md-2">{{ form.group_by.label_tag }} {{ form.group_by }}</div>
    <div class="col-md-12">
      <button type="submit" class="btn btn-primary mt-2">Filter</button>
      <a href="{% url 'reports:export' 'xlsx' %}?{{ request.GET.urlencode }}" class="btn btn-success mt-2">â¬‡ Export Excel</a>
      <a href="{% url 'reports:export' 'pdf' %}?{{ request.GET.urlencode }}" class="btn btn-danger mt-2">â¬‡ Export PDF</a>
    </div>
  </form>
</div>

<h3>Recent Reports</h3>
<table class="table table-bordered">
  <thead class="table-light">
  <tr>
    <th>ID</th>
    <th>Date</th>
    <th>Exam Name</th>
    <th>Exam Type</th>
    <th>Referred By</th>
    <th>Sonologist</th>
    <th>Total Ultra</th>
  </tr>
</thead>
<tbody>
  {% for r in reports %}
  <tr>
    <td>{{ r.id_number }}</td>   <!-- âœ… show patient ID -->
    <td>{{ r.date|date:"d M Y" }}</td>
    <td>{{ r.exam_name }}</td>
    <td>{{ r.exam_type }}</td>
    <td>{{ r.referred_by }}</td>
    <td>{{ r.sonologist }}</td>
    <td>{{ r.total_ultra }}</td>
  </tr>
  {% empty %}
  <tr><td colspan="7">No records found</td></tr>
  {% endfor %}
</tbody>

</table>

<h3>ðŸ“… Daily USG Count by Doctor</h3>
<table class="table table-bordered">
  <thead class="table-secondary">
    <tr><th>Date</th><th>Doctor</th><th>Total USG</th></tr>
  </thead>
  <tbody>
    {% for row in daily_by_doctor %}
    <tr>
      <td>{{ row.day|date:"d M Y" }}</td>
      <td>{{ row.referred_by }}</td>
      <td>{{ row.total_usg }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No data</td></tr>
    {% endfor %}
  </tbody>
</table>

<h3>ðŸ“Š Monthly USG Count by Sonologist</h3>
<table class="table table-bordered">
  <thead class="table-warning">
    <tr><th>Month</th><th>Sonologist</th><th>Total USG</th></tr>
  </thead>
  <tbody>
    {% for row in monthly_by_sonologist %}
    <tr>
      <td>{{ row.month|date:"F Y" }}</td>
      <td>{{ row.sonologist }}</td>
      <td>{{ row.total_usg }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No data</td></tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
