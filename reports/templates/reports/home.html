{% extends 'base.html' %}
{% load form_tags %}
{% block content %}
<h2 class="mb-4 fw-bold">Add New USG Report</h2>

<!-- Show messages-->
{% if messages %}
  {% for message in messages %}
    <div class="alert 
      {% if message.tags == 'success' %}alert-success
      {% elif message.tags == 'error' %}alert-danger
      {% else %}alert-info{% endif %}
      alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="card shadow p-4 mb-5">
  <form method="post">
  {% csrf_token %}
  <div class="row g-3">
    <div class="col-md-6">{{ form.date.label_tag }} {{ form.date|add_class:"form-control date-picker" }}</div>
    <div class="col-md-6">{{ form.id_number.label_tag }} {{ form.id_number }}</div>
  </div>
  <div class="row g-3 mt-2">
    <div class="col-md-6">{{ form.exam_name.label_tag }} {{ form.exam_name }}</div>
    <div class="col-md-6">{{ form.exam_type.label_tag }} {{ form.exam_type }}</div>
  </div>
  <div class="row g-3 mt-2">
    <div class="col-md-6">{{ form.referred_by.label_tag }} {{ form.referred_by }}</div>
    <div class="col-md-6">{{ form.sonologist.label_tag }} {{ form.sonologist }}</div>
  </div>
  <div class="row g-3 mt-2">
    <div class="col-md-6">{{ form.total_ultra.label_tag }} {{ form.total_ultra }}</div>
    <div class="col-md-6">{{ form.notes.label_tag }} {{ form.notes }}</div>
  </div>
  <button type="submit" class="btn btn-primary mt-3">Save Report</button>
</form>
</div>

<h3 class="mb-3">Recent Reports</h3>
<div class="card shadow p-3">
  <table class="table table-hover">
    <thead class="table-primary">
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Patient ID</th>
        <th>Exam Name</th>
        <th>Exam Type</th>
        <th>Referred By</th>
        <th>Sonologist</th>
        <th>Total Ultra</th>
      </tr>
    </thead>
    <tbody>
      {% for report in reports %}
      <tr>
        <td>{{ report.id }}</td>
        <td>{{ report.date|date:"d M Y" }}</td>
        <td>{{ report.id_number }}</td>
        <td>{{ report.exam_name }}</td>
        <td>{{ report.exam_type }}</td>
        <td>{{ report.referred_by }}</td>
        <td>{{ report.sonologist }}</td>
        <td>{{ report.total_ultra }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="8">No reports found</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // Hide alerts automatically after 3 seconds
  setTimeout(() => {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
      alert.classList.remove('show');
      alert.classList.add('fade');
      // Wait 500ms (animation time), then remove the element from DOM
      setTimeout(() => alert.remove(), 500);
    });
  }, 3000);
</script>

{% endblock %}
